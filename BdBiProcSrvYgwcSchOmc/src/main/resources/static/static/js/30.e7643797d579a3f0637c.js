webpackJsonp([30],{NU34:function(e,t){},r3yT:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("fZjL"),o=a.n(l),r=a("Dd8w"),n=a.n(r),s=a("Cz8s"),i=a("+Ap0"),c=a("woOf"),u=a.n(c),m=a("qo4X"),p={data:function(){var e=this;return{accountDetail:JSON.parse(localStorage.getItem("ACCOUNTDETAILS")),checkRole:!1,checkDone:!0,activeRole:"activeRoleType",roleId:null,ruleForm:{roleType:"",roleName:"",remark:""},rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:["blur","change"]},{validator:function(t,a,l){if(!/^[\u4e00-\u9fa5]{1,10}$/.test(a))return e.checkDone=!0,l(new Error("输入为汉字且不超过10个!"));e.checkRoleExist(l)},trigger:["blur"]}],remark:[{validator:function(e,t,a){if(void 0!==t&&null!==t&&""!==t&&!/^[\u4e00-\u9fa5]{0,50}$/.test(t))return a(new Error("输入为汉字且不超过50个!"));a()},trigger:["blur","change"]}]}}},props:["roleInfo"],watch:{roleInfo:function(e){this.setRole(e)}},created:function(){this.setRole(this.roleInfo)},methods:{setRole:function(e){e&&e.roleId?(this.roleId=e.roleId,this.ruleForm.roleType="学校"==e.roleType?"2":"1",this.ruleForm.roleName=e.roleName,this.ruleForm.remark=e.roleDiscrip):this.clearData()},clearData:function(){var e=this;this.roleId=null,o()(this.ruleForm).forEach(function(t){e.ruleForm[t]=null}),this.ruleForm.roleType="2"},checkRoleExist:function(e){var t=this;this.checkRole=!0,m.a.checkRoleEnable({roleType:this.ruleForm.roleType,roleName:this.ruleForm.roleName}).then(function(a){if(t.checkRole=!1,t.checkDone=a.result&&1e3===a.result.code,!t.checkDone)return e(new Error("该角色名已经存在！"));e()}).catch(function(e){console.log(e)})},onSubmit:function(){var e=this;this.$refs.ruleForm.validate(function(t){if(!t)return!1;var a=u()({},e.ruleForm);e.roleId&&(a.roleId=e.roleId);var l={uri:e.roleId?"amEditRole":"amAddRole",querys:a};m.a.handleRole(l).then(function(t){1e3===t.result.code&&e.$message({message:"角色"+(e.roleId?"编辑":"添加")+"成功！",type:"success",duration:2e3})&&e.$vnode.context.getTableData(),e.onCancel(),e.clearData()}).catch(function(e){console.log(e)})})},onCancel:function(){this.$refs.ruleForm.resetFields(),this.$msgbox.close()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("button",{staticClass:"el-message-box__headerbtn",staticStyle:{position:"absolute",top:"-30px"},attrs:{type:"button","aria-label":"Close"},on:{click:e.onCancel}},[a("i",{staticClass:"el-message-box__close el-icon-close"})]),e._v(" "),a("el-form",{ref:"ruleForm",staticClass:"back-white create create-form",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px",id:"roleForm"}},[a("el-tabs",{directives:[{name:"show",rawName:"v-show",value:!e.roleId||e.flase,expression:"roleId?flase:true"}],model:{value:e.activeRole,callback:function(t){e.activeRole=t},expression:"activeRole"}},[a("el-tab-pane",{attrs:{label:"选择角色类型",name:"activeRoleType"}},[a("el-radio",{directives:[{name:"show",rawName:"v-show",value:"学校"!=e.accountDetail.userOrgId,expression:"accountDetail.userOrgId != '学校'"}],attrs:{label:"1"},model:{value:e.ruleForm.roleType,callback:function(t){e.$set(e.ruleForm,"roleType",t)},expression:"ruleForm.roleType"}},[e._v("监管部门")]),e._v(" "),a("el-radio",{attrs:{label:"2"},model:{value:e.ruleForm.roleType,callback:function(t){e.$set(e.ruleForm,"roleType",t)},expression:"ruleForm.roleType"}},[e._v("学校")])],1)],1),e._v(" "),a("br"),e._v(" "),a("el-tabs",[a("el-tab-pane",{attrs:{label:"设置角色名称"}},[e.roleId?e._e():a("el-form-item",{attrs:{label:"角色名称：",prop:"roleName"}},[a("el-input",{directives:[{name:"show",rawName:"v-show",value:!e.roleId,expression:"!roleId"}],attrs:{placeholder:"设置角色名称(不超过10个汉字)"},model:{value:e.ruleForm.roleName,callback:function(t){e.$set(e.ruleForm,"roleName",t)},expression:"ruleForm.roleName"}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:null==e.roleId&&!e.checkDone&&e.ruleForm.roleName,expression:"roleId != null?false:(!checkDone && ruleForm.roleName)"}],staticClass:"exist-check",staticStyle:{color:"#22c290",top:"5px",position:"relative"}},[a("i",{staticClass:"el-icon-success"}),e._v(" "),a("span",[e._v("验证通过")])]),e._v(" "),a("span",{directives:[{name:"loading",rawName:"v-loading",value:e.checkRole,expression:"checkRole"}],staticClass:"exist-check",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 1)"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.roleId,expression:"roleId"}],attrs:{label:"角色名称："}},[a("label",{staticClass:"label-text"},[e._v(e._s(e.ruleForm.roleName))])]),e._v(" "),a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"(不超过50个汉字)"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}},[e._v(e._s(e.ruleForm.remark))])],1)],1)],1),e._v(" "),a("el-form-item",{staticClass:"form-btn-warpper"},[a("el-button",{on:{click:e.onCancel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确认")])],1)],1)],1)},staticRenderFns:[]};var h=a("VU/8")(p,d,!1,function(e){a("NU34")},null,null).exports,f=a("NYxO"),g={data:function(){return{isCollapse:this.$store.state.ui.navIsOpen,exportLoading:!1,loadingData:!1,querys:{},roleNameCodes:[],roleTypeCodes:[],pageInfo:null,tableData:[],page:1,pageSize:20}},watch:{"$store.state.ui.navIsOpen":function(e,t){this.isCollapse=e}},created:function(){this.getSelectData(),this.getTableData()},methods:n()({},Object(f.b)(["getRoleManList","getOptions","exportTableData"]),{setParams:function(){var e=this,t={page:this.page,pageSize:this.pageSize};return o()(this.querys).forEach(function(a){e.querys[a]&&(t[a]=e.querys[a])}),t},getSelectData:function(){var e=this;["roleNameCodes","roleTypeCodes"].forEach(function(t){var a={url:"/biUser/v1/"+t,querys:{}};e.getOptions(a).then(function(a){e[t]=a[t]}).catch(function(e){console.log(e)})})},getTableData:function(){var e=this;this.loadingData=!0;var t=this.setParams();this.getRoleManList(t).then(function(t){e.tableData=t.amRoleManage,e.pageInfo=t.pageInfo,e.loadingData=!1}).catch(function(e){console.log(e)})},showRoleForm:function(e){var t=this.$createElement;this.$msgbox({title:"添加角色",showConfirmButton:!1,showClose:!1,message:t(h,{props:{roleInfo:e}})})},handleTabClick:function(e,t){this.activeTab=e.name},showModal:function(e,t,a){var l=this;this.$confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){e&&l.handleAction(e,t)}).catch(function(e){console.log(e)})},handleAction:function(e,t){e&&this[e](t)},deleteRole:function(e){var t=this;m.a.deleteRole({roleId:e}).then(function(e){1e3===e.result.code&&t.$message({message:"角色删除成功！",type:"success"}),t.getTableData()}).catch(function(e){console.log(e)})},handleSizeChange:function(e){this.pageSize=e,this.getTableData()},handleCurrentChange:function(e){this.page=e,this.getTableData()},exportData:function(){var e=this;this.exportLoading=!0;var t={url:"/biUser/v1/expAmRoleManage",querys:this.setParams()};this.exportTableData(t).then(function(t){e.exportLoading=!1,e.$utils.downLoad(t.expAmRoleManage.expFileUrl)}).catch(function(e){console.log(e)})}}),components:{Header:s.a,Breadcrumb:i.a,roleForm:h}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"container"}},[a("Header"),e._v(" "),a("div",{staticClass:"main",class:{fullsize:1==e.isCollapse}},[a("Breadcrumb"),e._v(" "),a("div",{staticClass:"wrapperContent",attrs:{id:"infoWarning"}},[a("el-form",{staticClass:"search-form-inline",attrs:{inline:!0}},[a("el-form-item",[a("el-select",{attrs:{placeholder:"角色",clearable:"",filterable:""},model:{value:e.querys.roleName,callback:function(t){e.$set(e.querys,"roleName",t)},expression:"querys.roleName"}},e._l(e.roleNameCodes,function(e){return a("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}))],1),e._v(" "),a("el-form-item",[a("el-select",{attrs:{placeholder:"类型",clearable:"",filterable:""},model:{value:e.querys.roleType,callback:function(t){e.$set(e.querys,"roleType",t)},expression:"querys.roleType"}},e._l(e.roleTypeCodes,function(e){return a("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){(e.page=1)&&e.getTableData()}}},[a("i",{staticClass:"iconfont icon-search icon-distance icon-1x"}),e._v("查询")])],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.showRoleForm(null)}}},[a("i",{staticClass:"iconfont icon-plus icon-distance icon-1x"}),e._v("添加")])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.exportLoading,expression:"exportLoading"}],attrs:{type:"primary","element-loading-text":"导出中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 1)",plain:""},on:{click:function(t){e.exportData()}}},[a("i",{staticClass:"iconfont icon-export icon-1x"}),a("span",[e._v("导出")])])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingData,expression:"loadingData"}],attrs:{height:"calc(100% - 150px)",data:e.tableData,"element-loading-text":"加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 1)",stripe:""}},[a("el-table-column",{attrs:{align:"center",prop:"roleName",label:"角色"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"roleType",label:"类型"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"roleDiscrip",label:"描述"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"creator",label:"创建人"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"createTime",label:"创建日期"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"success",plain:""},on:{click:function(a){e.showRoleForm(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"danger",plain:""},on:{click:function(a){t.row.isRelAccount?e.showModal(null,null,"该角色已经关联账户，先取消关联才可删除!"):e.showModal("deleteRole",t.row.roleId,"确认删除该角色？")}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{"current-page":e.pageInfo&&e.pageInfo.curPageNum,"page-sizes":[20,30,50,100],"page-size":20,layout:"total, sizes, prev, pager, next, jumper",total:e.pageInfo&&e.pageInfo.pageTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)},staticRenderFns:[]},b=a("VU/8")(g,v,!1,null,null,null);t.default=b.exports}});